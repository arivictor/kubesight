{% extends "base.html" %}

{% block title %}Logs - {{ container }} - {{ pod_name }} - KubeSight{% endblock %}

{% block content %}
<div class="logs-page">
    <!-- Navigation Actions -->
    {% if nav_links and nav_links.back %}
        <div class="nav-actions">
            <a href="{{ nav_links.back.href }}" class="btn btn-secondary">
                ‚Üê {{ nav_links.back.label }}
            </a>
        </div>
    {% endif %}
    
    <!-- Page Info -->
    <div class="page-info">
        <h2>CONTAINER LOGS</h2>
        <p class="log-info">Pod: {{ pod_name }} | Container: {{ container }} | Namespace: {{ namespace }}</p>
    </div>

    <!-- Controls -->
    <div class="logs-controls">
        <div class="control-group">
            <label for="tail-lines">SHOW LAST:</label>
            <select id="tail-lines" onchange="updateLogs()">
                <option value="50">50 LINES</option>
                <option value="100" selected>100 LINES</option>
                <option value="200">200 LINES</option>
                <option value="500">500 LINES</option>
                <option value="1000">1000 LINES</option>
            </select>
        </div>
        <div class="control-group">
            <button class="btn btn-primary" onclick="refreshLogs()">
                REFRESH
            </button>
        </div>
        <div class="control-group">
            <button class="btn btn-secondary" onclick="downloadLogs()">
                DOWNLOAD
            </button>
        </div>
    </div>

    <!-- Logs Content -->
    <div class="logs-section">
        <div class="logs-container" id="logs-content">
            <pre>{{ logs if logs else 'No logs available' }}</pre>
        </div>
    </div>
</div>

<script>
function updateLogs() {
    const tailLines = document.getElementById('tail-lines').value;
    const currentUrl = new URL(window.location);
    currentUrl.searchParams.set('tail', tailLines);
    window.location.href = currentUrl.toString();
}

function refreshLogs() {
    window.location.reload();
}

function downloadLogs() {
    const logs = document.querySelector('#logs-content pre').textContent;
    const blob = new Blob([logs], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `{{ pod_name }}-{{ container }}-logs.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}
</script>
{% endblock %}